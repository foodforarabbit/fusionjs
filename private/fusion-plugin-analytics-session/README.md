# @uber/fusion-plugin-analytics-session

Generates and provides analytics sessions data - such as id, timestamp - in a cookie

---

### Table of contents

- [Installation](#installation)
- [Usage](#usage)
- [Setup](#setup)
- [API](#api)
  - [Registration API](#registration-api)
    - [`AnalyticsSession`](#analyticssession)
    - [`AnalyticsSessionToken`](#analyticssessiontoken)
  - [Dependencies](#dependencies)
    - [`AnalyticsCookieTypeToken`](#analyticscookietypetoken)
    - [`UberWebEventCookie`](#uberwebeventcookie)

---

### Installation

```
yarn add @uber/fusion-plugin-analytics-session
```

---

### Usage

```js
app.middleware({session: AnalyticsSessionToken}, ({session}) => {
  return (ctx, next) => {
    const {session_id, session_time_ms} = session.from(ctx);
    return next();
  }
});
```

---

### Setup

```js
// main.js
import AnalyticsSession, {UberWebEventCookie, AnalyticsCookieTypeToken, AnalyticsSessionToken} from 'fusion-plugin-analytics-session';
import App from 'fusion-react';
import MyPlugin from './plugins/my-plugin';

export default function start() {
  const app = new App(root);

  app.register(AnalyticsSessionToken, AnalyticsSession);
  app.register(AnalyticsCookieTypeToken, UberWebEventCookie);

  return app;
}
```

---

### API

#### Registration API

##### `AnalyticsSession`

The plugin. It should be registered to [`AnalyticsSessionToken`](#analyticssessiontoken)

##### `AnalyticsSessionToken`

Should be registered with the [`AnalyticsSession`](#analyticssession) plugin

#### Dependencies

##### `AnalyticsCookieTypeToken`

A cookie configuration object. Should be registered with [`UberWebEventCookie`](#uberwebeventcookie)

###### Types

```flow
type CookieType = {
  name: string,
  options: {
    maxAge: number,
    expires: number,
  },
  data: {
    session_id: string,
    session_time_ms: string,
  },
};
```

- `name: string` - The cookie name
- `options`
  - `maxAge: number` - cookie max-age (in seconds)
  - `expires: number` - cookie expires (in seconds)
- `data`
  - `session_id: string` - unique session ID. Autogenerated
  - `session_time_ms: Date` - timestamp. Autogenerated
- `rolling: boolean` - continue to update the expiry as the user is browsing

##### `UberWebEventCookie`

A value of type `CookieType`

```js
{
  name: '_ua',
  options: {
    maxAge: null,
    expires: null,
  },
  data: {
    session_id: UUID, // autogenerated
    session_time_ms: TIME_STAMP, // autogenerated
  },
}
```